Fix the context in shortcode error messages. Move the shortcode integration tests into a separate file and add new tests. For tests with multiline shortcodes, use content hashes for comparison to improve failure detection. This addresses issue #13279, related to context issues with some embedded templates.