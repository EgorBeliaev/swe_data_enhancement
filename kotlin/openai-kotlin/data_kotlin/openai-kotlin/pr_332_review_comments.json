[
    {
        "title": "untested fix: make .models() call not crash if created or owned_by are missing in some endpoints (openrouter)"
    },
    {
        "author": {
            "login": "PR Description"
        },
        "body": "| Q                 | A\r\n| ----------------- | ----------\r\n| Bug fix?          | yes\r\n| New feature?      | no\r\n| BC breaks?        | not sure\r\n| Related Issue     | Fix #331\r\n\r\n## Describe your change\r\n\r\nThis change was suggested by GPT-4 as I don't know Kotlin. Moreover I don't know how openai-kotlin was engineered so I don't know if that breaks backward compatibility or if some parts of the lib rely on the fields `created` and `owned-by` to exist.\r\n\r\n## What problem is this fixing?\r\n\r\nIn issue #331 I reported that listing models fails with the endpoint of openrouter because those two keys are missing. To me supporting openrouter.ai would really be awesome because they support [many many many models](https://openrouter.ai/docs#models) including from OpenAI, Anthropic, Cohere, Mistral, Google, etc. So even the bare minimum amount of compatibility (listing models, calling completion etc) would go a really long way in terms of how much flexibility that would give to your lib!\r\n\r\n\r\nEdit: here's a typical output from `curl https://openrouter.ai/api/v1/models |jq`:\r\n```\r\n    {\r\n      \"id\": \"cohere/command-r-plus\",\r\n      \"name\": \"Cohere: Command R+\",\r\n      \"description\": \"Command R+ is a new, 104B-parameter LLM from Cohere. It's useful for roleplay, general consumer usecases, and Retrieval Augmented Generation (RAG).\\n\\nIt offers multilingual support for ten key languages to facilitate global business operations. See benchmarks and the launch post [here](https://txt.cohere.com/command-r-plus-microsoft-azure/).\\n\\nUse of this model is subject to Cohere's [Acceptable Use Policy](https://docs.cohere.com/docs/c4ai-acceptable-use-policy).\",\r\n      \"pricing\": {\r\n        \"prompt\": \"0.000003\",\r\n        \"completion\": \"0.000015\",\r\n        \"image\": \"0\",\r\n        \"request\": \"0\"\r\n      },\r\n      \"context_length\": 128000,\r\n      \"architecture\": {\r\n        \"modality\": \"text\",\r\n        \"tokenizer\": \"Cohere\",\r\n        \"instruct_type\": null\r\n      },\r\n      \"top_provider\": {\r\n        \"max_completion_tokens\": 4000,\r\n        \"is_moderated\": false\r\n      },\r\n      \"per_request_limits\": null\r\n    }\r\n```\r\n\r\nSo indeed the owned_by and created fields don't exist, but I don't know if those extra fields like \"pricing\" would cause a crash or not."
    },
    {
        "author": {
            "login": "aallam"
        },
        "body": "Sounds good, thanks for your contribution!"
    },
    {
        "author": {
            "login": "coolbeevip"
        },
        "body": "When might be able to release this version?"
    },
    {
        "data": {
            "repository": {
                "issue": {
                    "title": "Bug: endpoint openrouter fails because the output is missing Fields[created, owned_by]",
                    "body": "### Description\r\n\r\nGot redirected here from [this SpeakGPT issue](https://github.com/AndraxDev/speak-gpt/issues/105).\r\n\r\nThis seems to happen when the function `openAI.models` is called and because the outputs do not contain \"created\" nor \"owned_by\" keys.\r\n\r\n**Also, if you don't mind me asking, do you accept bounties for quick fix?**\r\n\r\nHere's the error message: `Fields [created, owned_by] are required for type with serial name 'com.aallam.openai.api.model.Model', but they were missing`\r\n\r\nFull log from the SpeakGPT crash:\r\n<details><summary>Expand</summary>\r\n\r\n```\r\n\r\n===== BEGIN OF CRASH =====\r\nm2.j: Illegal input: Fields [created, owned_by] are required for type with serial name 'com.aallam.openai.api.model.Model', but they were missing at path: $.data[0]\r\n\tat w2.d.a(Unknown Source:77)\r\n\tat w2.d.e(Unknown Source:122)\r\n\tat w2.b.m(Unknown Source:12)\r\n\tat x8.a.g(Unknown Source:5)\r\n\tat n9.k0.run(Unknown Source:101)\r\n\tat android.os.Handler.handleCallback(Handler.java:959)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:100)\r\n\tat android.os.Looper.loopOnce(Looper.java:232)\r\n\tat android.os.Looper.loop(Looper.java:317)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8532)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ExecInit.main(ExecInit.java:50)\r\n\tat com.android.internal.os.RuntimeInit.nativeFinishInit(Native Method)\r\n\tat com.android.internal.os.RuntimeInit.main(RuntimeInit.java:359)\r\n\tSuppressed: r9.f: [p1{Cancelling}@c04cf55, Dispatchers.Main]\r\nCaused by: u7.f: Illegal input: Fields [created, owned_by] are required for type with serial name 'com.aallam.openai.api.model.Model', but they were missing at path: $.data[0]\r\n\tat v7.j.a(Unknown Source:316)\r\n\tat u7.b.a(Unknown Source:178)\r\n\tat p9.e.a(Unknown Source:185)\r\n\tat u7.c.a(Unknown Source:49)\r\n\tat j9.k.e(Unknown Source:73)\r\n\tat d5.f0.a(Unknown Source:82)\r\n\tat i7.g.b(Unknown Source:245)\r\n\tat a7.b.m(Unknown Source:365)\r\n\tat a7.b.h(Unknown Source:52)\r\n\tat b8.m.f(Unknown Source:35)\r\n\tat b8.m.d(Unknown Source:27)\r\n\tat a7.d.m(Unknown Source:678)\r\n\tat a7.d.h(Unknown Source:132)\r\n\tat b8.m.f(Unknown Source:35)\r\n\tat b8.m.d(Unknown Source:27)\r\n\tat b8.m.e(Unknown Source:2)\r\n\tat a7.b.m(Unknown Source:517)\r\n\tat a7.b.h(Unknown Source:106)\r\n\tat b8.m.f(Unknown Source:35)\r\n\tat b8.m.d(Unknown Source:27)\r\n\tat b8.m.a(Unknown Source:18)\r\n\tat b8.e.a(Unknown Source:177)\r\n\tat b7.c.a(Unknown Source:177)\r\n\tat w2.d.e(Unknown Source:106)\r\n\tat w2.b.m(Unknown Source:12)\r\n\tat x8.a.g(Unknown Source:5)\r\n\tat n9.k0.run(Unknown Source:109)\r\n\t... 10 more\r\nCaused by: w9.b: Fields [created, owned_by] are required for type with serial name 'com.aallam.openai.api.model.Model', but they were missing at path: $.data[0]\r\n\tat ca.g0.y(Unknown Source:122)\r\n\tat ca.g0.f(Unknown Source:40)\r\n\tat aa.s.k(Unknown Source:6)\r\n\tat aa.a.j(Unknown Source:29)\r\n\tat aa.a.a(Unknown Source:0)\r\n\tat ca.g0.y(Unknown Source:66)\r\n\tat ca.g0.f(Unknown Source:40)\r\n\tat l2.d.a(Unknown Source:100)\r\n\tat ca.g0.y(Unknown Source:66)\r\n\tat ba.b.a(Unknown Source:19)\r\n\tat v7.j.a(Unknown Source:204)\r\n\t... 36 more\r\nCaused by: w9.b: Fields [created, owned_by] are required for type with serial name 'com.aallam.openai.api.model.Model', but they were missing\r\n\tat aa.c1.h(Unknown Source:104)\r\n\tat r2.c.<init>(Unknown Source:27)\r\n\tat r2.a.a(Unknown Source:96)\r\n\tat ca.g0.y(Unknown Source:66)\r\n\t... 46 more\r\n\r\n===== END OF CRASH =====\r\n\r\n```\r\n\r\n</details>\r\n\r\n### Steps to Reproduce\r\n\r\n1. Set the url to `https://openrouter.ai/api/v1/`\r\n2. Call `openai.models()`\r\n3. Notice the error\r\n\r\n### Environment\r\n\r\n- **openai-kotlin version**: 3.7.1\r\n- **Kotlin version**: Don't know\r\n- **OS**: Android\r\n\r\n",
                    "state": "CLOSED",
                    "comments": {
                        "nodes": [
                            {
                                "author": {
                                    "login": "AndraxDev"
                                },
                                "body": "Now you have all field in Model.kt object non-nullable. I propose to perform the following changes to Model.kt file:\r\n\r\n```kt\r\npackage com.aallam.openai.api.model\r\n\r\nimport kotlinx.serialization.SerialName\r\nimport kotlinx.serialization.Serializable\r\n\r\n/**\r\n * OpenAI's Model.\r\n */\r\n@Serializable\r\npublic data class Model(\r\n    @SerialName(\"id\") public val id: ModelId,\r\n    @SerialName(\"created\") public val created: Long?, /* make the following parameter nullable */\r\n    @SerialName(\"owned_by\") public val ownedBy: String?, /* make the following parameter nullable */\r\n    @SerialName(\"permission\") public val permission: List<ModelPermission>? = null,\r\n)\r\n```\r\n\r\nIn context of smart assistant I think params owned_by and create are not required and it can be made optional. For examle the OpenRouter (https://openrouter.ai/docs#models)(OpenAI API standard) which is a revolution among LLM providers uses the following JSON object of model:\r\n\r\n```json\r\n{\r\n    \"id\": \"openrouter/auto\",\r\n    \"name\": \"Auto (best for prompt)\",\r\n    \"description\": \"Depending on their size, subject, and complexity, your prompts will be sent to [Mistral Large](/models/mistralai/mistral-large) or [GPT-4 Turbo](/models/openai/gpt-4-turbo).  To see which model was used, visit [Activity](/activity).\",\r\n    \"pricing\": {\r\n        \"prompt\": \"-1\",\r\n        \"completion\": \"-1\",\r\n        \"request\": \"-1\",\r\n        \"image\": \"-1\"\r\n    },\r\n    \"context_length\": 128000,\r\n    \"architecture\": {\r\n        \"modality\": \"text\",\r\n        \"tokenizer\": \"Router\",\r\n        \"instruct_type\": null\r\n    },\r\n    \"top_provider\": {\r\n        \"max_completion_tokens\": null,\r\n        \"is_moderated\": false\r\n    },\r\n    \"per_request_limits\": null\r\n}\r\n```\r\n\r\nSo this object does not have owned_by and created fields. When we use `https://openrouter.ai/api/v1/` everythong works except model list.\r\n\r\nP.S: *The temporary solution for me is to send bare HTTP request, but I would like to use the same library and engine to provide user with best experience.*"
                            }
                        ]
                    }
                }
            }
        }
    }
]