[
    {
        "title": "Perform vertex serialization as doubles, as that's what we compute in"
    },
    {
        "author": {
            "login": "PR Description"
        },
        "body": "Fixes #5447"
    },
    {
        "author": {
            "login": "nophead"
        },
        "body": "I thought STL files have to be floats?"
    },
    {
        "author": {
            "login": "kintel"
        },
        "body": "It's just text. This PR really just reverts a change from September this year where we changed from double to float, triggering the mentioned issue."
    },
    {
        "author": {
            "login": "kintel"
        },
        "body": "Oh, not September, it was a year ago: #4867 - the assert issue was just discovered in September. Anyway, I think this is the right fix for now, as downstream software parsing ascii STL as double has the chance of recovering the topology. If it causes any issues, we could try converting to float first, then cull degenerate triangles before export."
    },
    {
        "author": {
            "login": "nophead"
        },
        "body": "You would also have to fix self intersections. Several years ago I tried removing degenerate triangles but realised it was a waste of time because truncation to floats or perhaps the grid snap also creates self intersections and inside out triangles. In general you need a full mesh fixup after truncation when there is no separate topology info."
    },
    {
        "author": {
            "login": "kintel"
        },
        "body": "Yeah, this is a can of worms, which is why it's safer, for now, to just operate in double space, and assert if degenerate triangles occur during export. At some point, backends like Manifold might be able to safely produce output in floating point space, but I don't think they're quite there yet."
    },
    {
        "author": {
            "login": "kintel"
        },
        "body": "@pca006132 See above, in case this it on your radar, or you have meaningful comments"
    },
    {
        "author": {
            "login": "pca006132"
        },
        "body": "I'm still not sure why we should assert on degenerate triangles, is it prohibited in STL?\r\n\r\nAlso, are we using double precision for binary STLs?\r\n\r\nManifold should have better support for mesh decimation later, and that should help to produce meshes that are safe when truncated to single precision, hopefully."
    },
    {
        "author": {
            "login": "pca006132"
        },
        "body": "And should we really crash when there is a degenerate triangle? I think throwing some other exception would be better, ask the user to modify their design slightly or use another export format."
    },
    {
        "author": {
            "login": "nophead"
        },
        "body": "Binary STLs have to be floats because the file format specifies it.\r\n\r\nDegenerate triangles, self intersections and flipped triangles in STLs can break downstream programs and can't be imported into OpenSCAD. The format only works representing physical objects that can be 3D printed. Not things like 2 cubes sharing an edge or a vertex."
    },
    {
        "author": {
            "login": "pca006132"
        },
        "body": "Instead of crashing, I think we should just have a warning/error saying we cannot export the mesh because it is invalid in STL, and suggest the user to try another format."
    },
    {
        "author": {
            "login": "kintel"
        },
        "body": "This PR fixes the crash issue. There still is an assert in the code, but it's there to detect an internal inconsistency which should never trigger on user input."
    },
    {
        "author": {
            "login": "whitelynx"
        },
        "body": "I'll confirm, this also fixed the issue in my much more complex use case! Thanks @kintel!"
    },
    {
        "data": {
            "repository": {
                "issue": {
                    "title": "nondeterministic export_stl.cc assertion failure at line 172",
                    "body": "Several days ago, I started seeing failures on the CI for a project of mine which uses OpenSCAD. The command line is `openscad --hardwarnings --backend Manifold --summary all -o out/scad/croom.stl scad/croom.scad`, and an assertion is being triggered:\r\n\r\n```c\r\ntime openscad --hardwarnings --backend Manifold --summary all -o out/scad/croom.stl scad/croom.scad\r\nopenscad: /home/dank/src/openscad/src/io/export_stl.cc:172: uint64_t {anonymous}::append_stl(std::shared_ptr<const PolySet>, std::ostream&, bool): Assertion `s0 != s1 && s0 != s2 && s1 != s2' failed.\r\nCommand terminated by signal 6\r\n```\r\n\r\nThis does not happen all the time. I can reproduce it on my Linux workstation and laptop; a second invocation is usually sufficient to get things working. I'm going to dig in with valgrind and see what can be seen (I'll also test without Manifold), but wanted to get this report up.\r\n\r\n**To Reproduce**\r\nThe file listed above is https://github.com/dankamongmen/dankdryer/blob/master/scad/croom.scad.\r\nIf you want to look into this, you can check out https://github.com/dankamongmen/dankdryer and run `make out/scad/croom.stl`. As mentioned, it doesn't always happen.\r\n\r\n**Expected behavior**\r\nI expect to run to completion without triggering the `assert()`.\r\n\r\n**Code reproducing the issue**\r\nWorking on this.\r\n\r\n**Environment and Version info (please complete the following information):**\r\n - OS: Debian Linux Unstable\r\n - System: amd64\r\n - OpenSCAD Version: 2024.10.17-dirty\r\n\r\n**Library & Graphics card information**\r\nrepresentative but not nominative:\r\n\r\n```c\r\n[grimes](0) $ openscad --info | grep -v fonts\r\nQObject::startTimer: Timers can only be used with threads started with QThread\r\nOpenSCAD Version: 2024.10.17\r\nSystem information: Linux 6.11.3-arch1-1 #1 SMP PREEMPT_DYNAMIC Thu, 10 Oct 2024 20:11:06 +0000 x86_64 Arch Linux 8 CPUs 15.49 GB RAM\r\nUser Agent: OpenSCAD/2024.10.17 (Linux x86_64; Arch Linux)\r\nCompiler: GCC \"14.2.1 20240910\" 64bit\r\nMinGW build: No\r\nDebug build: No\r\nBoost version: 1_86\r\nEigen version: 3.4.0\r\nCGAL version, kernels: 6.0, Cartesian<Gmpq>, Extended_cartesian<Gmpq>, Epeck\r\nOpenCSG version: OpenCSG 1.6.0\r\nQt version: 5.15.15\r\nQScintilla version: 2.14.1\r\nInputDrivers: \r\nGLib version: 2.82.1\r\nlodepng version: 20230410\r\nlibzip version: 1.10.1\r\nfontconfig version: 2.15.0\r\nfreetype version: 2.13.3\r\nharfbuzz version: 10.0.1 (runtime: 10.1.0)\r\ncairo version: 1.18.2\r\nlib3mf version: 2.3.0\r\nApplication Path: /usr/local/bin\r\nDocuments Path: /home/dank/.local/share\r\nUser Documents Path: /home/dank\r\nResource Path: /usr/local/share/openscad\r\nUser Library Path: /home/dank/.local/share/OpenSCAD/libraries\r\nUser Config Path: /home/dank/.config/OpenSCAD\r\nBackup Path: /home/dank/.local/share/OpenSCAD/backups\r\nOPENSCADPATH: <not set>\r\nOpenSCAD library path:\r\n  /home/dank/.local/share/OpenSCAD/libraries\r\n  /usr/local/share/openscad/libraries\r\n\r\nOPENSCAD_FONT_PATH: <not set>\r\nOpenSCAD font path:\r\n  /System/Library/Fonts\r\n  /Library/Fonts\r\n  /home/dank/Library/Fonts\r\n\r\n\r\nGL context creator: EGL (new)\r\nEGL version: 1.5\r\nPNG generator: lodepng\r\n\r\nGLAD version: 2.0.4\r\nOpenGL Version: 4.6 (Compatibility Profile) Mesa 24.2.7-arch1.1\r\nGL Renderer: Mesa Intel(R) UHD Graphics 620 (KBL GT2)\r\nGL Vendor: Intel\r\nRGBA(8888), depth(24), stencil(8)\r\nGL_ARB_framebuffer_object: yes\r\nGL_EXT_framebuffer_object: yes\r\nGL_EXT_packed_depth_stencil: yes\r\n\r\n[grimes](0) $ \r\n```\r\n\r\n**Additional context**\r\nLike I said, I feel capable of resolving this, and will look into it today. If this is a duplicate or otherwise related to some other bug, though, please link them up. Thanks!",
                    "state": "CLOSED",
                    "comments": {
                        "nodes": [
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "alright we've got a hot hit from valgrind right off the bat\r\n\r\n```c\r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D931E: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5efe50 is 0 bytes inside a block of size 497 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x511782D: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_mutate(unsigned long, unsigned long, char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x51320A0: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_append(char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x1F0389: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > std::operator+<char, std::char_traits<char>, std::allocator<char> >(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D92F9: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D93E3: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5efaf0 is 0 bytes inside a block of size 58 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x511782D: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_mutate(unsigned long, unsigned long, char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x51320A0: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_append(char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x1F043B: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > std::operator+<char, std::char_traits<char>, std::allocator<char> >(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D917C: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D947E: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5efa30 is 0 bytes inside a block of size 124 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x511782D: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_mutate(unsigned long, unsigned long, char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x51320A0: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_append(char const*, unsigned long) (in /usr/lib/lib3mf.so.2.3.0.0)\r\n==160944==    by 0x1F043B: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > std::operator+<char, std::char_traits<char>, std::allocator<char> >(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D904A: CGAL::Failure_exception::Failure_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9AC8: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D9AEA: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef9b0 is 0 bytes inside a block of size 51 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0xD6938D: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char*>(char*, char*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9A79: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D9AF6: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef950 is 0 bytes inside a block of size 32 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0xD6938D: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char*>(char*, char*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9A60: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D9B02: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef8a0 is 0 bytes inside a block of size 110 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0xD6938D: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char*>(char*, char*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9A4A: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1D9B0E: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef840 is 0 bytes inside a block of size 20 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x1C42B1: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char const*>(char const*, char const*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1C3085: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string<std::allocator<char> >(char const*, std::allocator<char> const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9A34: CGAL::Assertion_exception::Assertion_exception(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1DA02D: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1DA058: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef7c0 is 0 bytes inside a block of size 51 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x1C42B1: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char const*>(char const*, char const*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1C3085: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string<std::allocator<char> >(char const*, std::allocator<char> const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9FD3: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1DA074: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef760 is 0 bytes inside a block of size 32 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x1C42B1: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char const*>(char const*, char const*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1C3085: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string<std::allocator<char> >(char const*, std::allocator<char> const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9FA6: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\n==160944== Mismatched free() / delete / delete []\r\n==160944==    at 0x48478EF: free (vg_replace_malloc.c:989)\r\n==160944==    by 0x1DA090: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944==  Address 0xb5ef6b0 is 0 bytes inside a block of size 110 alloc'd\r\n==160944==    at 0x4846613: operator new[](unsigned long) (vg_replace_malloc.c:729)\r\n==160944==    by 0x1C42B1: void std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_construct<char const*>(char const*, char const*, std::forward_iterator_tag) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1C3085: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string<std::allocator<char> >(char const*, std::allocator<char> const&) (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D9F79: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944==    by 0x1B3334: (below main) (in /usr/local/bin/openscad)\r\n==160944== \r\nterminate called after throwing an instance of 'CGAL::Assertion_exception'\r\n  what():  CGAL ERROR: assertion violation!\r\nExpr: -CGAL_IA_MUL(-1.1, 10.1) != CGAL_IA_MUL(1.1, 10.1)\r\nFile: /usr/include/CGAL/Interval_nt.h\r\nLine: 287\r\nExplanation: Wrong rounding: did you forget the  -frounding-math  option if you use GCC (or  -fp-model strict  for Intel)?\r\n==160944== \r\n==160944== Process terminating with default action of signal 6 (SIGABRT): dumping core\r\n==160944==    at 0x736B3F4: __pthread_kill_implementation (pthread_kill.c:44)\r\n==160944==    by 0x731211F: raise (raise.c:26)\r\n==160944==    by 0x72F94C2: abort (abort.c:79)\r\n==160944==    by 0x6FC9B2B: __gnu_cxx::__verbose_terminate_handler() [clone .cold] (vterminate.cc:95)\r\n==160944==    by 0x6FDFF39: __cxxabiv1::__terminate(void (*)()) (eh_terminate.cc:48)\r\n==160944==    by 0x6FC9529: std::terminate() (eh_terminate.cc:58)\r\n==160944==    by 0x6FE01F5: __cxa_throw (eh_throw.cc:98)\r\n==160944==    by 0x1DA0D0: CGAL::assertion_fail(char const*, char const*, int, char const*) (in /usr/local/bin/openscad)\r\n==160944==    by 0x2003BE: CGAL::Interval_nt<false>::Test_runtime_rounding_modes::Test_runtime_rounding_modes() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8249: __static_initialization_and_destruction_0() (in /usr/local/bin/openscad)\r\n==160944==    by 0x1D8333: _GLOBAL__sub_I_ManifoldGeometry.cc (in /usr/local/bin/openscad)\r\n==160944==    by 0x72FAF43: call_init (libc-start.c:145)\r\n==160944==    by 0x72FAF43: __libc_start_main@@GLIBC_2.34 (libc-start.c:347)\r\n==160944== \r\n==160944== HEAP SUMMARY:\r\n==160944==     in use at exit: 161,657 bytes in 603 blocks\r\n==160944==   total heap usage: 759 allocs, 156 frees, 189,625 bytes allocated\r\n==160944== \r\n==160944== LEAK SUMMARY:\r\n==160944==    definitely lost: 0 bytes in 0 blocks\r\n==160944==    indirectly lost: 0 bytes in 0 blocks\r\n==160944==      possibly lost: 3,017 bytes in 8 blocks\r\n==160944==    still reachable: 156,624 bytes in 574 blocks\r\n==160944==                       of which reachable via heuristic:\r\n==160944==                         stdstring          : 285 bytes in 1 blocks\r\n==160944==         suppressed: 0 bytes in 0 blocks\r\n==160944== Rerun with --leak-check=full to see details of leaked memory\r\n==160944== \r\n==160944== For lists of detected and suppressed errors, rerun with: -s\r\n==160944== ERROR SUMMARY: 10 errors from 10 contexts (suppressed: 0 from 0)\r\nAborted (core dumped)\r\n```"
                            },
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "note that the output above is a different exception, but if we've got memory safety problems, all bets afterwards are of course off. looking into this more deeply now."
                            },
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "adding `--debug all` and rebuilkding OpenSCAD with `-DCMAKE_BUILD_TYPE=debug -DMANIFOLD_DEBUG=ON`"
                            },
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "using a debug build, i noticed the following output before a failure:\r\n```\r\nCGAL Cache insert: multmatrix([[1,0,0,327.683],[0,1,0,327.6 (0 bytes)\r\nmimalloc: warning: thread 0x7f46fcff06c0: unable to allocate aligned OS memory directly, fall back to over-allocation (268435456 bytes, address: 0x7f46dee00000, alignment: 4194304, commit: 1)\r\nmimalloc: warning: thread 0x7f46f1fc56c0: unable to allocate aligned OS memory directly, fall back to over-allocation (268435456 bytes, address: 0x7f46cee00000, alignment: 4194304, commit: 1)\r\nCGAL Cache insert: multmatrix([[1,0,0,0],[0,1,0,0],[0,0,1,- (0 bytes)\r\nopenscad: /home/dank/src/dankamongmen/openscad/src/io/export_stl.cc:172: uint64_t {anonymous}::append_stl(std::shared_ptr<const PolySet>, std::ostream&, bool): Assertion `s0 != s1 && s0 != s2 && s1 != s2' failed.\r\nCommand terminated by signal 6\r\n```\r\n\r\nthat mimalloc output might not be related, but i thought it worth mentioning."
                            },
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "if i compile with `MIMALLOC_USE=off`, i no longer get those valgrind warnings. it appears mimalloc doesn't get along well with valgrind: https://github.com/microsoft/mimalloc/issues/251. looking deeper."
                            },
                            {
                                "author": {
                                    "login": "kintel"
                                },
                                "body": "@pca006132 this sounds like expected behavior of Manifold V3. Do you agree?\r\n\r\nEdit: Uh, never mind, I missed a bunch of context when I first read this on my phone.."
                            },
                            {
                                "author": {
                                    "login": "kintel"
                                },
                                "body": "I can reproduce on macOS. I feel this is a double->float conversion issue, which was introduced almost a year ago. ..but it's possible that recent changes to Manifold has triggered creation of vertices close enough together to trigger this issue.\r\n\r\nI'd love a minimal example of the issue for regression test purposes, but expect that to be tricky to pull together."
                            },
                            {
                                "author": {
                                    "login": "pca006132"
                                },
                                "body": "For manifold, it is expected to have degenerate triangles in the output. We will need an improved mesh decimator to remove degenerate triangles with a higher epsilon, which @elalish is working on now iirc."
                            },
                            {
                                "author": {
                                    "login": "pca006132"
                                },
                                "body": "But I'm wondering why degenerate triangles are not allowed in STL?"
                            },
                            {
                                "author": {
                                    "login": "dankamongmen"
                                },
                                "body": "> I can reproduce on macOS. I feel this is a double->float conversion issue, which was introduced almost a year ago. ..but it's possible that recent changes to Manifold has triggered creation of vertices close enough together to trigger this issue.\r\n> \r\n> I'd love a minimal example of the issue for regression test purposes, but expect that to be tricky to pull together.\r\n\r\ni can try, but do remember that this only happens sometimes. does that not sound more like an uninitialized value or perhaps a race (manifold is multithreaded, right)? i might try running with TSAN/ASAN."
                            }
                        ]
                    }
                }
            }
        }
    }
]