Enable logging for the `test` run mode and ensure that all sessions are consistently closed, especially when exceptions occur in future returning endpoints and in all cases for stream returning endpoints. Address SandPod's suggestion to make the test endpoint setup and side effects more explicit.