[
    {
        "title": "Fix android audio issue when screen is off and broadcast audio session id"
    },
    {
        "author": {
            "login": "PR Description"
        },
        "body": "I tested these changes on a couple of Android devices and everything was working. I'm pretty confident that favoring audiotrack output over opensles is safe. Adding the extra comma at the end (\"audiotrack,opensles,\"), makes libmpv select another audio output not provided in the list, but available on the device.\r\n\r\nMy flutter skills being low, I might not have properly named the variables, formatted the code or defined constants in the proper place, so constructive comments are welcomed \ud83d\ude43 \r\n\r\nFor reference, here's the list of devices I tested:\r\n\r\n- Pixel 6a\r\n- Pixel 2\r\n- Galaxy A01\r\n- Galaxy S7\r\n- Galaxy Tab S7\r\n- Fire HD 8 (10th gen)\r\n"
    },
    {
        "author": {
            "login": "KRTirtho"
        },
        "body": ""
    },
    {
        "author": {
            "login": "KRTirtho"
        },
        "body": "Wow, that's a really awesome fix for this issue. I was trying to fix it for a quite a while. Thanks for the help \u2764\ufe0f \r\n\r\n> My flutter skills being low, I might not have properly named the variables, formatted the code or defined constants in the proper place, so constructive comments are welcomed \ud83d\ude43\r\n\r\nIt is good enough for anyone who started writing dart recently. No worries. I'll clean it up a little bit after merging although most of it is correct and works \ud83d\ude04 "
    },
    {
        "author": {
            "login": "KRTirtho"
        },
        "body": "`flutter_broadcasts` is causing trouble in AndroidPluginRegistrant. Is it working for you?\r\n\r\n```\r\nResolving dependencies...\r\n  _fe_analyzer_shared 61.0.0 (67.0.0 available)\r\n  analyzer 5.13.0 (6.4.1 available)\r\n  app_package_maker 0.0.9 (0.3.6 available)\r\n  app_package_maker_aab 0.0.9 (0.2.3 available)\r\n  app_package_maker_apk 0.0.9 (0.2.3 available)\r\n  app_package_maker_deb 0.0.9 (0.2.3 available)\r\n  app_package_maker_dmg 0.0.9 (0.2.3 available)\r\n  app_package_maker_exe 0.0.9 (0.2.3 available)\r\n  app_package_maker_ipa 0.0.9 (0.2.3 available)\r\n  app_package_maker_zip 0.0.9 (0.2.3 available)\r\n  archive 3.4.5 (3.4.10 available)\r\n  audio_service_mpris 0.1.0 (0.1.3 available)\r\n  audio_session 0.1.16 (0.1.18 available)\r\n  build_daemon 4.0.0 (4.0.1 available)\r\n  build_resolvers 2.3.2 (2.4.2 available)\r\n  build_runner 2.4.6 (2.4.8 available)\r\n  build_runner_core 7.2.10 (7.3.0 available)\r\n  built_value 8.6.2 (8.9.1 available)\r\n  buttons_tabbar 1.3.7+1 (1.3.8 available)\r\n  cached_network_image 3.3.0 (3.3.1 available)\r\n  cached_network_image_platform_interface 3.0.0 (4.0.0 available)\r\n  cached_network_image_web 1.1.0 (1.1.1 available)\r\n  catcher_2 1.0.0 (1.2.3 available)\r\n  change_case 1.1.0 (2.0.1 available)\r\n  cli_util 0.4.0 (0.4.1 available)\r\n  code_builder 4.6.0 (4.10.0 available)\r\n  cross_file 0.3.3+5 (0.3.4+1 available)\r\n  dart_style 2.3.2 (2.3.4 available)\r\n  dbus 0.7.8 (0.7.10 available)\r\n  device_info_plus 9.0.3 (9.1.2 available)\r\n  dio 5.3.3 (5.4.1 available)\r\n  disable_battery_optimization 1.1.0+1 (1.1.1 available)\r\n  dots_indicator 2.1.2 (3.0.0 available)\r\n  envied 0.3.0+3 (0.5.3 available)\r\n  envied_generator 0.3.0+3 (0.5.3 available)\r\n  ffi 2.1.0 (2.1.2 available)\r\n  file_selector 1.0.1 (1.0.3 available)\r\n  file_selector_android 0.5.0+3 (0.5.0+7 available)\r\n  file_selector_ios 0.5.1+6 (0.5.1+8 available)\r\n  file_selector_macos 0.9.3+2 (0.9.3+3 available)\r\n  file_selector_platform_interface 2.6.1 (2.6.2 available)\r\n  file_selector_web 0.9.2+1 (0.9.4+1 available)\r\n  fluentui_system_icons 1.1.214 (1.1.229 available)\r\n  flutter_app_builder 0.0.9 (0.3.7 available)\r\n  flutter_app_packager 0.0.9 (0.3.7 available)\r\n* flutter_broadcasts 0.4.0 (was 0.4.1 from git https://github.com/imdatsolak/flutter_broadcasts.git at d58dd9)\r\n  flutter_distributor 0.0.2 (0.3.7 available)\r\n  flutter_gen_core 5.3.1 (5.4.0 available)\r\n  flutter_gen_runner 5.3.1 (5.4.0 available)\r\n  flutter_hooks 0.20.1 (0.20.5 available)\r\n  flutter_inappwebview 5.7.2+3 (6.0.0 available)\r\n  flutter_keyboard_visibility 5.4.1 (6.0.0 available)\r\n  flutter_lints 2.0.3 (3.0.1 available)\r\n  flutter_mailer 2.1.1 (2.1.2 available)\r\n  flutter_native_splash 2.3.3 (2.3.13 available)\r\n  flutter_plugin_android_lifecycle 2.0.16 (2.0.17 available)\r\n  flutter_riverpod 2.4.3 (2.4.10 available)\r\n  flutter_rust_bridge 1.82.1 (1.82.6 available)\r\n  flutter_sharing_intent 1.1.0 (1.1.1 available)\r\n  flutter_svg 1.1.6 (2.0.10+1 available)\r\n  fluttertoast 8.2.2 (8.2.4 available)\r\n  freezed 2.4.6 (2.4.7 available)\r\n  go_router 12.1.3 (13.2.0 available)\r\n  hooks_riverpod 2.4.3 (2.4.10 available)\r\n! http 1.1.0 (overridden) (1.2.1 available)\r\n  image 4.1.3 (4.1.7 available)\r\n  image_picker 1.0.4 (1.0.7 available)\r\n  image_picker_android 0.8.8 (0.8.9+3 available)\r\n  image_picker_for_web 3.0.1 (3.0.2 available)\r\n  image_picker_ios 0.8.8+2 (0.8.9+1 available)\r\n  image_picker_platform_interface 2.9.1 (2.9.4 available)\r\n  intl 0.18.1 (0.19.0 available)\r\n  introduction_screen 3.1.11 (3.1.12 available)\r\n  js 0.6.7 (0.7.1 available)\r\n  leak_tracker 10.0.0 (10.0.4 available)\r\n  leak_tracker_flutter_testing 2.0.1 (3.0.3 available)\r\n  leak_tracker_testing 2.0.1 (3.0.1 available)\r\n  lints 2.1.1 (3.0.0 available)\r\n  logger 2.0.2 (2.0.2+1 available)\r\n  mailer 6.0.1 (6.1.0 available)\r\n  media_kit 1.1.7 (1.1.10+1 available)\r\n  media_kit_libs_android_audio 1.3.5 (1.3.6 available)\r\n  media_kit_libs_audio 1.0.3 (1.0.4 available)\r\n  meta 1.11.0 (1.12.0 available)\r\n  mime 1.0.4 (1.0.5 available)\r\n  mutex 3.0.1 (3.1.0 available)\r\n  package_info_plus 4.1.0 (5.0.1 available)\r\n  path_provider 2.1.1 (2.1.2 available)\r\n  path_provider_android 2.2.0 (2.2.2 available)\r\n  path_provider_foundation 2.3.1 (2.3.2 available)\r\n  path_provider_platform_interface 2.1.1 (2.1.2 available)\r\n  permission_handler 11.0.1 (11.3.0 available)\r\n  permission_handler_android 11.0.5 (12.0.5 available)\r\n  permission_handler_apple 9.1.4 (9.4.0 available)\r\n  permission_handler_platform_interface 3.11.5 (4.2.0 available)\r\n  permission_handler_windows 0.1.3 (0.2.1 available)\r\n  petitparser 5.4.0 (6.0.2 available)\r\n  plugin_platform_interface 2.1.6 (2.1.8 available)\r\n  pointycastle 3.7.3 (3.7.4 available)\r\n  popover 0.2.8+2 (0.3.0 available)\r\n  provider 6.0.5 (6.1.1 available)\r\n  puppeteer 3.2.0 (3.7.0 available)\r\n  riverpod 2.4.3 (2.5.0 available)\r\n  sentry 7.9.0 (7.16.1 available)\r\n  shared_preferences_foundation 2.3.4 (2.3.5 available)\r\n  shared_preferences_platform_interface 2.3.1 (2.3.2 available)\r\n  shared_preferences_web 2.2.1 (2.3.0 available)\r\n  simple_icons 7.10.0 (10.1.3 available)\r\n  skeletonizer 0.8.0 (1.0.1 available)\r\n  smtc_windows 0.1.1 (0.1.2 available)\r\n  source_gen 1.4.0 (1.5.0 available)\r\n  spotify 0.12.0 (0.13.1 available)\r\n  sqflite 2.3.0 (2.3.2 available)\r\n  sqflite_common 2.5.0 (2.5.3 available)\r\n  state_notifier 0.7.2+1 (1.0.0 available)\r\n  synchronized 3.1.0 (3.1.0+1 available)\r\n! system_tray 2.0.2 (overridden) (2.0.3 available)\r\n  test_api 0.6.1 (0.7.0 available)\r\n  time 2.1.3 (2.1.4 available)\r\n  url_launcher 6.1.14 (6.2.5 available)\r\n  url_launcher_android 6.1.0 (6.3.0 available)\r\n  url_launcher_ios 6.1.5 (6.2.4 available)\r\n  url_launcher_linux 3.0.6 (3.1.1 available)\r\n  url_launcher_macos 3.0.7 (3.1.0 available)\r\n  url_launcher_platform_interface 2.1.5 (2.3.2 available)\r\n  url_launcher_web 2.0.20 (2.3.0 available)\r\n  url_launcher_windows 3.0.8 (3.1.1 available)\r\n  uuid 3.0.7 (4.3.3 available)\r\n  vm_service 13.0.0 (14.0.0 available)\r\n  web_socket_channel 2.4.0 (2.4.4 available)\r\n  win32 5.0.7 (5.2.0 available)\r\n  window_manager 0.3.6 (0.3.8 available)\r\n  xdg_directories 1.0.3 (1.0.4 available)\r\n  xml 6.3.0 (6.5.0 available)\r\n  youtube_explode_dart 2.0.2 (2.1.0 available)\r\nChanged 1 dependency!\r\n134 packages have newer versions incompatible with dependency constraints.\r\nTry `flutter pub outdated` for more information.\r\nLaunching lib/main.dart on sdk gphone64 arm64 in debug mode...\r\nBuilding with Flutter multidex support enabled.\r\nYou are applying Flutter's app_plugin_loader Gradle plugin imperatively using the apply script method, which is deprecated and will be removed in a future release. Migrate to applying Gradle plugins with the declarative plugins block: https://flutter.dev/go/flutter-gradle-plugin-apply\r\n\r\nYou are applying Flutter's main Gradle plugin imperatively using the apply script method, which is deprecated and will be removed in a future release. Migrate to applying Gradle plugins with the declarative plugins block: https://flutter.dev/go/flutter-gradle-plugin-apply\r\n\r\n/Users/krtirtho/dev/spotube/android/app/src/main/java/io/flutter/plugins/GeneratedPluginRegistrant.java:54: error: package de.kevlatus.flutter_broadcasts does not exist\r\n      flutterEngine.getPlugins().add(new de.kevlatus.flutter_broadcasts.FlutterBroadcastsPlugin());\r\n                                                                       ^\r\n1 error\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':app:compileDevDebugJavaWithJavac'.\r\n> Compilation failed; see the compiler error output for details.\r\n\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n\r\n* Get more help at https://help.gradle.org\r\n\r\nBUILD FAILED in 38s\r\nError: Gradle task assembleDevDebug failed with exit code 1\r\n\r\n\r\nExited (1).\r\n```"
    },
    {
        "author": {
            "login": "olivier2"
        },
        "body": "No problem when cloning a fresh copy of my branch with flutter 3.16.9 and dart 3.2.6\r\n\r\nI'll try with your dev branch"
    },
    {
        "author": {
            "login": "olivier2"
        },
        "body": "No problem building from your dev with my changes. I ran into issues because I was mixing flutter versions (fvm vs global installed outside fvm), but fvm has proxy for flutter and dart commands so I tried everything a 2nd time cleanly from the start in order to write the following steps and it worked. Here's what I did (on Windows) for reference:\r\n\r\n> git clone --branch dev https://github.com/KRTirtho/spotube.git spotube-dev\r\n> cd spotube-dev\r\n> copy ..\\spotube\\\\.env .\r\n> git remote add olivier2 https://github.com/olivier2/spotube.git\r\n> git pull olivier2 android-audio-session-broadcast-clean\r\n\r\n...\r\nMerge made by the 'ort' strategy.\r\nlib/services/audio_player/mk_state_player.dart | 46 ++++++++++++++++++++++++--\r\npubspec.yaml                                   |  1 +\r\n2 files changed, 45 insertions(+), 2 deletions(-)\r\n\r\n> fvm list\r\n\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 Version \u2502 Channel \u2502 Flutter Version \u2502 Dart Version \u2502 Release Date \u2502 Global \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 3.19.1  \u2502 stable  \u2502 3.19.1          \u2502 3.3.0        \u2502 Feb 21, 2024 \u2502        \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n> fvm flutter pub get\r\n> fvm dart run build_runner build --delete-conflicting-outputs --enable-experiment=records,patterns\r\n> fvm flutter build apk --debug"
    },
    {
        "author": {
            "login": "KRTirtho"
        },
        "body": "I checked it now. And as you suspected, I was using a pre version of flutter through fvm.\r\nIt's builds and runs now after switching to 3.19.1\r\n\r\nSilly mistake by me. Sorry for the trouble \ud83d\ude05 \r\n"
    },
    {
        "author": {
            "login": "KRTirtho"
        },
        "body": "I can't test it in any device right now, and I can't reproduce it. So I'm merging it sort of blindly\ud83d\ude05, though the app builds, and no side effects are found \r\nThus, this PR is heavily dependent on community feedback. I'll update add it to nightly, so users can check it out, and they'll give feedbacks in the linked issue"
    }
]